<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product | Sunny Sugar Art</title>
<style>
  :root{ --ink:#1f1b14; --muted:#6b5f4a; --line:#efe5c9; --pill:#4b3a2b; --pill-ink:#fff; }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:#fff}
  a{color:inherit;text-decoration:none}
  header{padding:18px 20px;border-bottom:1px solid var(--line);display:flex;gap:10px}
  header a{font-weight:900}
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:28px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  h1{margin:0 0 6px}
  .price{font-weight:900;margin:6px 0 18px;font-size:1.2rem}

  /* 圖片區 */
  .gallery{display:grid;grid-template-columns:88px 1fr;gap:12px}
  .thumbs{display:flex;flex-direction:column;gap:8px;max-height:560px;overflow:auto;padding-right:2px}
  .thumbs img{width:88px;height:88px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer;display:block;background:#f7f4ee}
  .thumbs img[aria-current="true"]{border-color:#111}
  .stage{position:relative;border:1px solid #f2ecd7;border-radius:14px;overflow:hidden;background:#f7f4ee;height:560px}
  .stage img{width:100%;height:100%;object-fit:cover;display:block}
  .nav{position:absolute;top:50%;transform:translateY(-50%);background:#fff;border:0;border-radius:50%;width:40px;height:40px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.12)}
  .nav.prev{left:10px}.nav.next{right:10px}

  /* 表單 */
  label{display:block;margin:12px 0 8px;font-weight:800}
  select,button,input{font:inherit}
  select{width:100%;padding:10px 12px;border:1px solid #e9e1c7;border-radius:10px;background:#fff}

  .swatches{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .swatch{width:34px;height:34px;border-radius:10px;border:2px solid #ddd;cursor:pointer;display:inline-block}
  .swatch[aria-pressed="true"]{outline:2px solid #111;outline-offset:2px}

  /* 單色 */
  .swatch.white{background:#fff;border-color:#ccc}
  .swatch.black{background:#111}
  .swatch.orange{background:#fb923c}
  .swatch.gold{background:linear-gradient(135deg,#f59e0b,#facc15)}
  .swatch.red{background:#ef4444}
  .swatch.green{background:#10b981}
  .swatch.blue{background:#3b82f6}
  .swatch.purple{background:#8b5cf6}
  .swatch.brown{background:#8b5e3c}
  .swatch.yellow{background:#fde047}

  /* 雙色分割（50/50） */
  .swatch.split-blue-purple{background:linear-gradient(90deg,#3b82f6 50%,#8b5cf6 50%)}
  .swatch.split-red-green{background:linear-gradient(90deg,#ef4444 50%,#10b981 50%)}
  .swatch.split-red-white{background:linear-gradient(90deg,#ef4444 50%,#ffffff 50%)}
  .swatch.split-white-green{background:linear-gradient(90deg,#ffffff 50%,#10b981 50%)}

  /* 漸層（ring 外圈，不會混色成中間色） */
  .swatch.ring{background:#fff !important;border:6px solid transparent !important;box-sizing:border-box}
  .swatch.ring[aria-pressed="true"]{outline:2px solid #1f1b14;outline-offset:2px}

  /* Random 彩條 */
  .swatch.random{background:repeating-linear-gradient(45deg,#f87171 0 10px,#34d399 10px 20px,#60a5fa 20px 30px,#fbbf24 30px 40px)}

  /* More (+) */
  .swatch.more{display:flex;align-items:center;justify-content:center;font-weight:900;font-size:20px;color:#999;background:#fff;border:2px dashed #bbb}

  .btn{display:inline-block;margin-top:16px;background:#fff;border:2px solid var(--pill);color:var(--pill);padding:12px 18px;border-radius:999px;font-weight:900}
  .btn.primary{background:var(--pill);color:var(--pill-ink)}
  .note{margin-top:16px;font-size:.9rem;color:var(--muted)}
  .oops{padding:18px;border:1px solid #ffd1cd;background:#fff3f2;border-radius:12px}
</style>
</head>
<body>
<header>
  <a href="javascript:history.back()">← Back</a>
  <a href="index.html">Home</a>
</header>

<div class="wrap">
  <div id="grid" class="grid" style="display:none">
    <section>
      <div class="gallery">
        <div class="thumbs" id="thumbs"></div>
        <div class="stage">
          <img id="hero" alt="Product image" />
          <button class="nav prev" id="prev" aria-label="Previous image">‹</button>
          <button class="nav next" id="next" aria-label="Next image">›</button>
        </div>
      </div>
    </section>

    <aside>
      <h1 id="title">Loading…</h1>
      <div id="price" class="price"></div>

      <form id="buy">
        <label>Flavour
          <select id="flavour"></select>
        </label>

        <label>Pack Size
          <select id="pack"></select>
        </label>

        <label>Colour</label>
        <div class="swatches" id="swatches" role="group"></div>
        <input type="text" id="customColour" placeholder="Enter custom colours…" style="display:none;margin-top:8px;width:100%;padding:8px;border:1px solid #ccc;border-radius:8px" />

        <button type="submit" class="btn primary">Add to Cart</button>
        <button type="button" class="btn" onclick="location.href='mailto:sunnysugarart@gmail.com'">Email Us</button>
        <p class="note">Made to order. Contains egg & gluten. Nut‑free kitchen but traces may exist. Please book ahead for peak seasons.</p>
      </form>
    </aside>
  </div>

  <div id="oops" class="oops" style="display:none"></div>
</div>

<script>
/* ========== 你的最新商品資料（已合併） ========== */
const CATALOG = {
  halloween:{ items:{
    "pumpkin-charm":{ title:"Pumpkin Charm", price:"A$ 84.90",
      images:["images/halloween-pumpkin-charm.jpg","images/halloween-pumpkin-charm-2.jpg","images/halloween-pumpkin-charm-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "pumpkin-men":{ title:"Pumpkin Men", price:"A$ 84.90",
      images:["images/halloween-pumpkin-men.jpg","images/halloween-pumpkin-men-2.jpg","images/halloween-pumpkin-men-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Blue","Green","Purple","Random"]
    },
    "cauldron-cake":{ title:"Cauldron Cake", price:"A$ 84.90",
      images:["images/halloween-cauldron-cake.jpg","images/halloween-cauldron-cake-2.jpg","images/halloween-cauldron-cake-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Blue & Purple","Black","Random","More colours – leave a note"]
    },
    "drink-me":{ title:"Drink Me Bottles", price:"A$ 49.00",
      images:["images/halloween-drink-me.jpg","images/halloween-drink-me-2.jpg","images/halloween-drink-me-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Orange","Black","Random","More colours – leave a note"]
    },
    "ghostie-boo":{ title:"Ghostie Boo", price:"A$ 84.90",
      images:["images/halloween-ghostie-boo.jpg","images/halloween-ghostie-boo-2.jpg","images/halloween-ghostie-boo-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-skirt":{ title:"Witchy Skirt", price:"A$ 84.90",
      images:["images/halloween-witchy-skirt.jpg","images/halloween-witchy-skirt-2.jpg","images/halloween-witchy-skirt-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-brew":{ title:"Witchy Brew", price:"A$ 84.90",
      images:["images/halloween-witchy-brew.jpg","images/halloween-witchy-brew-2.jpg","images/halloween-witchy-brew-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Green","Purple","Black","Orange","Random","More colours – leave a note"]
    },
    "witchy-hat":{ title:"Witchy Hat", price:"A$ 84.90",
      images:["images/halloween-witchy-hat.jpg","images/halloween-witchy-hat-2.jpg","images/halloween-witchy-hat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "spooky-cat":{ title:"Spooky Cat", price:"A$ 84.90",
      images:["images/halloween-spooky-cat.jpg","images/halloween-spooky-cat-2.jpg","images/halloween-spooky-cat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "boo-candy":{ title:"Boo Candy", price:"A$ 84.90",
      images:["images/halloween-boo-candy.jpg","images/halloween-boo-candy-2.jpg","images/halloween-boo-candy-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    }
  }},
  christmas:{ items:{
    "snowflake":{ title:"Snowflake", price:"A$ 84.90",
      images:["images/christmas-snowflake.jpg","images/christmas-snowflake-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Blue","Purple","Blue & Purple","Random","More colours – leave a note"]
    },
    "happy-tree":{ title:"Happy Tree", price:"A$ 84.90",
      images:["images/christmas-happy-tree.jpg","images/christmas-happy-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["White","Red","Blue","Green","Yellow-green gradient","Blue gradient","Green gradient","Random","More colours – leave a note"]
    },
    "gingerbread":{ title:"Gingerbread Man", price:"A$ 84.90",
      images:["images/christmas-gingerbread.jpg","images/christmas-gingerbread-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Classic","Pastel","Random","More colours – leave a note"]
    },
    "candy-cane":{ title:"Candy Cane", price:"A$ 84.90",
      images:["images/christmas-candy-cane.jpg","images/christmas-candy-cane-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Red","Green","White & Red","White & Green","Red & Green","Random","More colours – leave a note"]
    },
    "surprise-tree":{ title:"Surprise Tree", price:"A$ 84.90",
      images:["images/christmas-surprise-tree.jpg","images/christmas-surprise-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Random","More colours – leave a note"]
    },
    "reindeer":{ title:"Reindeer", price:"A$ 84.90",
      images:["images/christmas-reindeer.jpg","images/christmas-reindeer-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["White","Brown","Random","More colours – leave a note"]
    },
    "snowman":{ title:"Snowman", price:"A$ 84.90",
      images:["images/christmas-snowman.jpg","images/christmas-snowman-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Classic","Random","More colours – leave a note"]
    },
    "santa-belt":{ title:"Santa Belt", price:"A$ 84.90",
      images:["images/christmas-santa-belt.jpg","images/christmas-santa-belt-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Red","More colours – leave a note"]
    }
  }}
};

/* ========== 小工具 ========== */
function getHash(name, def=""){ const m = location.hash.match(new RegExp(name+"=([^&]+)")); return m?decodeURIComponent(m[1]):def; }

/* 顏色文字 → CSS class / style */
function colourChip(label){
  const t = (label||"").trim().toLowerCase();

  // Random / More
  if(t.startsWith("random")) return {cls:"swatch random", title:label};
  if(t.startsWith("more"))   return {cls:"swatch more",  title:"+"};

  // 50/50 split
  if(t.includes("&")){
    const [a,b] = t.split("&").map(s=>s.trim());
    const key = `${a}-${b}`.replace(/\s+/g,"-");
    const map = {
      "blue-purple":"split-blue-purple",
      "red-green":"split-red-green",
      "red-white":"split-red-white",
      "white-green":"split-white-green"
    };
    if(map[key]) return {cls:`swatch ${map[key]}`, title:""};
  }

  // ring 漸層（Blue gradient / Green gradient / Yellow-green gradient）
  if(t.endsWith("gradient")){
    if(t.startsWith("blue"))   return {cls:"swatch ring", style:"border-color:#3b82f6;border-right-color:#60a5fa"};
    if(t.startsWith("green"))  return {cls:"swatch ring", style:"border-color:#10b981;border-right-color:#6ee7b7"};
    if(t.startsWith("yellow-green")) return {cls:"swatch ring", style:"border-color:#fde047;border-right-color:#10b981"};
  }

  // 單色
  const single = {
    "white":"white","black":"black","orange":"orange","gold":"gold","red":"red",
    "green":"green","blue":"blue","purple":"purple","brown":"brown","yellow":"yellow",
    "classic":"gold","pastel":"purple" // 先用近似表示
  };
  if(single[t]) return {cls:`swatch ${single[t]}`, title:""};

  // fallback
  return {cls:"swatch white", title:""};
}

/* ========== 渲染 ========== */
function render(){
  const cat = getHash('cat');
  const key = getHash('item');

  const grid   = document.getElementById('grid');
  const oops   = document.getElementById('oops');
  const heroEl = document.getElementById('hero');
  const thumbs = document.getElementById('thumbs');
  const title  = document.getElementById('title');
  const price  = document.getElementById('price');
  const flavourSel = document.getElementById('flavour');
  const packSel    = document.getElementById('pack');
  const swatches   = document.getElementById('swatches');
  const customInp  = document.getElementById('customColour');

  const item = CATALOG?.[cat]?.items?.[key];
  if(!item){
    grid.style.display='none';
    oops.style.display='block';
    oops.textContent = 'Product not found. Please go back and choose again.';
    return;
  }

  oops.style.display='none';
  grid.style.display='grid';

  title.textContent = item.title || 'Untitled';
  price.textContent = item.price || '';

  flavourSel.innerHTML = (item.flavours||[]).map(f=>`<option>${f}</option>`).join('');
  packSel.innerHTML    = (item.packs||[]).map(p=>`<option>${p}</option>`).join('');

  // 顏色 swatches
  const colours = item.colours?.length ? item.colours : ['Random'];
  swatches.innerHTML = colours.map((c,i)=>{
    const chip = colourChip(c);
    const extra = chip.style ? ` style="${chip.style}"` : "";
    const title = chip.title ? ` title="${chip.title}"` : "";
    return `<button type="button" class="${chip.cls}" data-color="${c}" aria-pressed="${i===0}"${extra}${title}>${chip.title||""}</button>`;
  }).join('');

  let chosenColour = colours[0];
  customInp.style.display = chosenColour.toLowerCase().startsWith('more') ? 'block' : 'none';

  swatches.querySelectorAll('.swatch').forEach(btn=>{
    btn.addEventListener('click',()=>{
      swatches.querySelectorAll('.swatch').forEach(b=>b.setAttribute('aria-pressed','false'));
      btn.setAttribute('aria-pressed','true');
      chosenColour = btn.dataset.color;
      customInp.style.display = chosenColour.toLowerCase().startsWith('more') ? 'block' : 'none';
      if (!customInp.style.display || customInp.style.display==='none') customInp.value="";
    });
  });

  // 圖片：忽略首頁大圖名稱；失敗自動濾掉
  const blocked = /(^|\/)(christmas\.jpg|halloween\.jpg)$/i;
  const planned = (item.images||[]).filter(src=>!blocked.test(src));

  function loadOne(src){
    return new Promise(res=>{
      const im = new Image();
      im.onload = ()=>res(src);
      im.onerror= ()=>res(null);
      im.src = src;
    });
  }
  Promise.all(planned.map(loadOne)).then(list=>{
    const imgs = list.filter(Boolean);
    if(!imgs.length){
      imgs.push('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="900"><rect width="100%" height="100%" fill="%23f5f0e6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23998" font-family="sans-serif" font-size="28">Image coming soon</text></svg>');
    }
    let idx = 0;
    const paint = ()=>{
      heroEl.src = imgs[idx];
      [...thumbs.querySelectorAll('img')].forEach((t,i)=>t.setAttribute('aria-current', i===idx));
    };
    thumbs.innerHTML = imgs.map((src,i)=>`<img src="${src}" alt="thumb ${i+1}" ${i===0?'aria-current="true"':''}>`).join('');
    thumbs.querySelectorAll('img').forEach((t,i)=>t.addEventListener('click',()=>{idx=i; paint();}));
    document.getElementById('prev').onclick = ()=>{idx=(idx-1+imgs.length)%imgs.length; paint();};
    document.getElementById('next').onclick = ()=>{idx=(idx+1)%imgs.length; paint();};
    paint();
  });

  // 提交示範
  document.getElementById('buy').onsubmit = (e)=>{
    e.preventDefault();
    const colourNote = chosenColour.toLowerCase().startsWith('more') ? (customInp.value||"(no note)") : chosenColour;
    alert(`Added:\n${item.title}\n${flavourSel.value} / ${packSel.value}\nColour: ${colourNote}\n${item.price||''}`);
  };
}

render();
window.addEventListener('hashchange', render);
</script>
</body>
</html>
