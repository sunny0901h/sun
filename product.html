<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product | Sunny Sugar Art</title>
<style>
  :root{ --ink:#1f1b14; --muted:#6b5f4a; --line:#efe5c9; --pill:#4b3a2b; --pill-ink:#fff; }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:#fff}
  a{color:inherit;text-decoration:none}
  header{padding:18px 20px;border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center}
  header .btnlink{font-weight:900;text-decoration:none;border:1px solid var(--line);padding:6px 10px;border-radius:999px}
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:28px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  h1{margin:0 0 6px}
  .price{font-weight:900;margin:6px 0 18px;font-size:1.2rem}

  /* gallery */
  .gallery{display:grid;grid-template-columns:88px 1fr;gap:12px}
  .thumbs{display:flex;flex-direction:column;gap:8px;max-height:560px;overflow:auto;padding-right:2px}
  .thumbs img{width:88px;height:88px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer;display:block;background:#f7f4ee}
  .thumbs img[aria-current="true"]{border-color:#111}
  .stage{position:relative;border:1px solid #f2ecd7;border-radius:14px;overflow:hidden;background:#f7f4ee;height:560px}
  .stage img{width:100%;height:100%;object-fit:cover;display:block}
  .nav{position:absolute;top:50%;transform:translateY(-50%);background:#fff;border:0;border-radius:50%;width:40px;height:40px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.12)}
  .nav.prev{left:10px}.nav.next{right:10px}

  /* form */
  label{display:block;margin:12px 0 8px;font-weight:800}
  select,button,input{font:inherit}
  select,input[type="text"]{width:100%;padding:10px 12px;border:1px solid #e9e1c7;border-radius:10px;background:#fff}
  .swatches{display:flex;gap:10px;flex-wrap:wrap}
  .swatch{width:34px;height:34px;border-radius:10px;border:2px solid transparent;cursor:pointer;position:relative}
  .swatch[aria-pressed="true"]{outline:2px solid #111;outline-offset:2px}
  .btn{display:inline-block;margin-top:16px;background:#fff;border:2px solid var(--pill);color:var(--pill);padding:12px 18px;border-radius:999px;font-weight:900}
  .btn.primary{background:var(--pill);color:var(--pill-ink)}
  .note{margin-top:16px;font-size:.9rem;color:var(--muted)}
  .oops{padding:16px 18px;margin:18px;border:1px solid #ffd1cd;background:#fff3f2;border-radius:12px;display:none;white-space:pre-wrap}
  .debug{font-size:.9rem;color:#8a6d3b;padding:0 24px 16px}
</style>
</head>
<body>
<header>
  <a class="btnlink" href="javascript:history.back()">← Back</a>
  <a class="btnlink" href="index.html">Home</a>
</header>

<div class="wrap">
  <div id="grid" class="grid" style="display:none">
    <!-- gallery -->
    <section>
      <div class="gallery">
        <div class="thumbs" id="thumbs"></div>
        <div class="stage">
          <img id="hero" alt="Product image" />
          <button class="nav prev" id="prev" aria-label="Previous image">‹</button>
          <button class="nav next" id="next" aria-label="Next image">›</button>
        </div>
      </div>
    </section>

    <!-- form -->
    <aside>
      <h1 id="title">Loading…</h1>
      <div id="price" class="price"></div>

      <form id="buy">
        <label>Flavour
          <select id="flavour"></select>
        </label>

        <label>Pack Size
          <select id="pack"></select>
        </label>

        <label>Colour</label>
        <div class="swatches" id="swatches" role="group" aria-label="Choose colour theme"></div>

        <!-- 自訂顏色留言盒（選到「More colours…」時顯示） -->
        <div id="customColorBox" style="display:none; margin-top:10px">
          <label style="margin-top:2px">Colour note
            <input id="customColorInput" type="text" placeholder="e.g. blue→purple gradient with gold specks">
          </label>
          <small style="color:#6b5f4a">Tell us your exact colours or gradient idea here.</small>
        </div>

        <button type="submit" class="btn primary">Add to Cart</button>
        <button type="button" class="btn" onclick="location.href='mailto:sunnysugarart@gmail.com'">Email Us</button>
        <p class="note">Made to order. Contains egg & gluten. Nut‑free kitchen but traces may exist. Please book ahead for peak seasons.</p>
      </form>
    </aside>
  </div>

  <div id="oops" class="oops"></div>
  <div class="debug" id="debug"></div>
</div>

<script>
/* ----------------- 資料：用 JS 物件，不用 JSON.parse ----------------- */
const CATALOG = {
  halloween:{ items:{
    "pumpkin-charm":{ title:"Pumpkin Charm", price:"A$ 84.90",
      images:["images/halloween-pumpkin-charm.jpg","images/halloween-pumpkin-charm-2.jpg","images/halloween-pumpkin-charm-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "pumpkin-men":{ title:"Pumpkin Men", price:"A$ 84.90",
      images:["images/halloween-pumpkin-men.jpg","images/halloween-pumpkin-men-2.jpg","images/halloween-pumpkin-men-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Blue","Green","Purple","Random"]
    },
    "cauldron-cake":{ title:"Cauldron Cake", price:"A$ 84.90",
      images:["images/halloween-cauldron-cake.jpg","images/halloween-cauldron-cake-2.jpg","images/halloween-cauldron-cake-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Blue & Purple","Black","Random","More colours – leave a note"]
    },
    "drink-me":{ title:"Drink Me Bottles", price:"A$ 49.00",
      images:["images/halloween-drink-me.jpg","images/halloween-drink-me-2.jpg","images/halloween-drink-me-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Orange","Black","Random","More colours – leave a note"]
    },
    "ghostie-boo":{ title:"Ghostie Boo", price:"A$ 84.90",
      images:["images/halloween-ghostie-boo.jpg","images/halloween-ghostie-boo-2.jpg","images/halloween-ghostie-boo-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-skirt":{ title:"Witchy Skirt", price:"A$ 84.90",
      images:["images/halloween-witchy-skirt.jpg","images/halloween-witchy-skirt-2.jpg","images/halloween-witchy-skirt-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-brew":{ title:"Witchy Brew", price:"A$ 84.90",
      images:["images/halloween-witchy-brew.jpg","images/halloween-witchy-brew-2.jpg","images/halloween-witchy-brew-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Green","Purple","Black","Orange","Random","More colours – leave a note"]
    },
    "witchy-hat":{ title:"Witchy Hat", price:"A$ 84.90",
      images:["images/halloween-witchy-hat.jpg","images/halloween-witchy-hat-2.jpg","images/halloween-witchy-hat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "spooky-cat":{ title:"Spooky Cat", price:"A$ 84.90",
      images:["images/halloween-spooky-cat.jpg","images/halloween-spooky-cat-2.jpg","images/halloween-spooky-cat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "boo-candy":{ title:"Boo Candy", price:"A$ 84.90",
      images:["images/halloween-boo-candy.jpg","images/halloween-boo-candy-2.jpg","images/halloween-boo-candy-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    }
  }},

  christmas:{ items:{
    "snowflake":{ title:"Snowflake", price:"A$ 84.90",
      images:["images/christmas-snowflake.jpg","images/christmas-snowflake-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Blue","Purple","Blue & Purple","Random","More colours – leave a note"]
    },
    "happy-tree":{ title:"Happy Tree", price:"A$ 84.90",
      images:["images/christmas-happy-tree.jpg","images/christmas-happy-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["White","Red","Blue","Green","Yellow-green gradient","Blue gradient","Green gradient","Random","More colours – leave a note"]
    },
    "gingerbread":{ title:"Gingerbread Man", price:"A$ 84.90",
      images:["images/christmas-gingerbread.jpg","images/christmas-gingerbread-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Classic","Pastel","Random","More colours – leave a note"]
    },
    "candy-cane":{ title:"Candy Cane", price:"A$ 84.90",
      images:["images/christmas-candy-cane.jpg","images/christmas-candy-cane-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Red","Green"," White & Red","White & Green","Red & Green","Random","More colours – leave a note"]
    },
    "surprise-tree":{ title:"Surprise Tree", price:"A$ 84.90",
      images:["images/christmas-surprise-tree.jpg","images/christmas-surprise-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Random","More colours – leave a note"]
    },
    "reindeer":{ title:"Reindeer", price:"A$ 84.90",
      images:["images/christmas-reindeer.jpg","images/christmas-reindeer-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["White","Brown","Random","More colours – leave a note"]
    },
    "snowman":{ title:"Snowman", price:"A$ 84.90",
      images:["images/christmas-snowman.jpg","images/christmas-snowman-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Classic","Random","More colours – leave a note"]
    },
    "santa-belt":{ title:"Santa Belt", price:"A$ 84.90",
      images:["images/christmas-santa-belt.jpg","images/christmas-santa-belt-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["10 PACK","15 PACK","30 PACK","50 PACK"],
      colours:["Red","More colours – leave a note"]
    }
  }}
};

/* ---------- 顏色：強化漸層視覺 ---------- */
/* 開關：banded / split / shimmer */
const GRADIENT_MODE = 'split'; // ← 想換效果：'banded' | 'split' | 'shimmer'

const PALETTE = {
  blue:"#3b82f6", purple:"#8b5cf6", green:"#10b981", red:"#ef4444",
  white:"#ffffff", black:"#111111", gold:"#f59e0b", brown:"#8b5e3c", yellow:"#fde047",
  pink:"#f472b6", orange:"#fb923c", "yellow-green":"#a3e635"
};
const STRONG = { // 每個主色對應一個更深或更亮的搭配色
  blue:"#1d4ed8", purple:"#6d28d9", green:"#15803d", red:"#b91c1c",
  yellow:"#b45309", "yellow-green":"#3f6212"
};

/* 小工具 */
function token(t){ return t.trim().toLowerCase(); }
function hexFor(name){
  const n = token(name).replace('champagne','gold');
  return PALETTE[n] || "#999";
}
function abbrev(label){
  // 生成角標文字（BG = Blue Gradient, B&P = Blue & Purple, RND = Random, MORE = More colours）
  const l = label.toLowerCase();
  if(l.includes('more colours') || l.includes('more colors')) return 'MORE';
  if(l.includes('random')) return 'RND';
  if(l.includes('&')){
    return label.split('&').map(s=>s.trim()[0]).join('&').toUpperCase(); // e.g. B&P
  }
  if(l.includes('gradient')){
    const base = label.replace(/gradient/i,'').trim();
    return (base.split(/\s+/).map(s=>s[0]).join('')+'G').toUpperCase(); // e.g. BG, YGG
  }
  return label[0].toUpperCase();
}

/* 主邏輯：把顏色標籤轉成 CSS 背景 + 角標 */
function styleForColourLabel(label){
  const raw = label.trim();
  const l = raw.toLowerCase();

  // 自訂：More colours
  if(l.includes('more colours') || l.includes('more colors')){
    return {
      css:'background:#fff;border:2px dashed #d4a373',
      tag:'MORE'
    };
  }
  // 隨機：彩條
  if(l.includes('random')){
    return {
      css:'background:repeating-linear-gradient(45deg,#fcd34d 0 10px,#86efac 10px 20px,#93c5fd 20px 30px,#f9a8d4 30px 40px,#fda4af 40px 50px)',
      tag:'RND'
    };
  }
  // 雙色：Blue & Purple
  if(l.includes('&')){
    const [a,b] = raw.split('&').map(s=>token(s));
    return {
      css:`background:linear-gradient(90deg, ${hexFor(a)} 0 50%, ${hexFor(b)} 50% 100%)`,
      tag:abbrev(raw)
    };
  }
  // 漸層（三種模式）
  if(l.includes('gradient')){
    // 解析 "Yellow-green gradient" 這種帶連字號的
    const base = token(raw.replace(/gradient/i,'').trim()).replace(/\s+/g,'-'); // e.g. blue, yellow-green
    const c1 = hexFor(base);
    const c2 = STRONG[base] || '#000';

    if(GRADIENT_MODE === 'split'){
      // 左 70% 主色，右 30% 深色，硬邊界
      return { css:`background:linear-gradient(90deg, ${c1} 0 70%, ${c2} 70% 100%)`, tag:abbrev(raw) };
    }
    if(GRADIENT_MODE === 'shimmer'){
      // 三色帶＋動畫，超明顯
      return { css:`background:linear-gradient(90deg, ${c1}, #ffffff, ${c2}); background-size:200% 100%; animation: shimmerMove 2s linear infinite;`, tag:abbrev(raw) };
    }
    // 預設 banded：硬邊條帶（c1 → 中間色 → c2）
    const mid = '#ffffff';
    return { css:`background:linear-gradient(90deg, ${c1} 0 33%, ${mid} 33% 66%, ${c2} 66% 100%)`, tag:abbrev(raw) };
  }

  // 單色
  const base = hexFor(raw);
  const extra = raw.toLowerCase()==='white' ? ';border:1px solid #e5e1d0' : '';
  return { css:`background:${base}${extra}`, tag:abbrev(raw) };
}

/* 建立色票（含角標與「More colours」留言框） */
function buildSwatches(swatchesEl, labels){
  const box = document.getElementById('customColorBox');
  const input = document.getElementById('customColorInput');

  const list = [...labels];
  if(!list.some(s=>/random/i.test(s))) list.push('Random');
  if(!list.some(s=>/more colours|more colors/i.test(s))) list.push('More colours – leave a note');

  swatchesEl.innerHTML = list.map((c,i)=>{
    const st = styleForColourLabel(c);
    const aria = i===0 ? 'true' : 'false';
    return `<button type="button" class="swatch" data-color="${c.replace(/"/g,'&quot;')}" aria-pressed="${aria}" title="${c}" style="${st.css||''}">
      <span class="tag">${st.tag||''}</span>
    </button>`;
  }).join('');

  let chosen = list[0];
  const buttons = swatchesEl.querySelectorAll('.swatch');

  function applySelection(btn){
    buttons.forEach(b=>b.setAttribute('aria-pressed','false'));
    btn.setAttribute('aria-pressed','true');
    chosen = btn.dataset.color;

    if(/more colours|more colors/i.test(chosen)){
      box.style.display = 'block';
      input.focus();
    }else{
      box.style.display = 'none';
    }
  }
  buttons.forEach(btn=>btn.addEventListener('click',()=>applySelection(btn)));

  return ()=>({ label: chosen, note: (/more colours|more colors/i.test(chosen) ? input.value.trim() : '') });
}

/* ----------------- 工具 ----------------- */
function getHash(name, def=""){ const m = location.hash.match(new RegExp(name+"=([^&]+)")); return m?decodeURIComponent(m[1]):def; }

/* ----------------- 主流程 ----------------- */
(function start(){
  const oops = document.getElementById('oops');
  const dbg  = document.getElementById('debug');

  function showError(msg, err){
    oops.style.display='block';
    oops.textContent = msg + (err ? ("\n\n" + (err.stack || err)) : "");
  }

  try{
    const cat = getHash('cat');   // e.g. halloween
    const key = getHash('item');  // e.g. pumpkin-charm
    dbg.textContent = `CAT=${cat} | ITEM=${key}`;

    const item = CATALOG?.[cat]?.items?.[key];
    if(!cat || !key || !item){
      document.getElementById('grid').style.display='none';
      showError('Product not found. Please go back and choose again.');
      return;
    }

    const grid   = document.getElementById('grid');
    const heroEl = document.getElementById('hero');
    const thumbs = document.getElementById('thumbs');
    const title  = document.getElementById('title');
    const price  = document.getElementById('price');
    const flavourSel = document.getElementById('flavour');
    const packSel    = document.getElementById('pack');
    const swatchesEl = document.getElementById('swatches');

    grid.style.display='grid';
    title.textContent = item.title || 'Untitled';
    price.textContent = item.price || '';

    flavourSel.innerHTML = (item.flavours||[]).map(f=>`<option>${f}</option>`).join('');
    packSel.innerHTML    = (item.packs||[]).map(p=>`<option>${p}</option>`).join('');

    // 顏色色票（含漸層/雙色/Random/自訂）
    const colours = item.colours?.length ? item.colours : ['Random'];
    const getColour = buildSwatches(swatchesEl, colours);

    // 載入圖片（若有壞圖會略過並顯示佔位）
    function loadOne(src){ return new Promise(res=>{ const im=new Image(); im.onload=()=>res(src); im.onerror=()=>res(null); im.src=src; }); }
    Promise.all((item.images||[]).map(loadOne)).then(all=>{
      const imgs = all.filter(Boolean);
      if(!imgs.length){
        imgs.push('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="900"><rect width="100%" height="100%" fill="%23f5f0e6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23998" font-family="sans-serif" font-size="28">Image coming soon</text></svg>');
      }
      let idx=0;
      const paint=()=>{ heroEl.src=imgs[idx]; [...thumbs.querySelectorAll('img')].forEach((t,i)=>t.setAttribute('aria-current', i===idx)); };
      thumbs.innerHTML = imgs.map((src,i)=>`<img src="${src}" alt="thumb ${i+1}" ${i===0?'aria-current="true"':''}>`).join('');
      thumbs.querySelectorAll('img').forEach((t,i)=>t.addEventListener('click',()=>{idx=i; paint();}));
      document.getElementById('prev').onclick = ()=>{idx=(idx-1+imgs.length)%imgs.length; paint();};
      document.getElementById('next').onclick = ()=>{idx=(idx+1)%imgs.length; paint();};
      paint();
    });

    // 送出（示例）
    document.getElementById('buy').onsubmit = (e)=>{
      e.preventDefault();
      const picked = getColour(); // {label, note}
      alert(
        `Added:\n${item.title}\n${flavourSel.value} / ${packSel.value}\n` +
        `Colour: ${picked.label}${picked.note ? ' ('+picked.note+')' : ''}\n` +
        `${item.price||''}`
      );
    };

  }catch(err){
    showError('Runtime error. Please screenshot this and send to me.', err);
  }
})();
</script>
</body>
</html>
