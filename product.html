<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product | Sunny Sugar Art</title>
<style>
  :root{ --ink:#1f1b14; --muted:#6b5f4a; --line:#efe5c9; --pill:#4b3a2b; --pill-ink:#fff; }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:#fff}
  a{color:inherit;text-decoration:none}
  header{padding:18px 20px;border-bottom:1px solid var(--line);display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  header a{font-weight:900;text-decoration:none}

  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:28px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  h1{margin:0 0 6px}
  .price{font-weight:900;margin:6px 0 18px;font-size:1.2rem}

  /* 圖片區（左縮圖、右主圖；主圖不裁切，等比置中） */
  .gallery{display:grid;grid-template-columns:88px 1fr;gap:12px}
  .thumbs{display:flex;flex-direction:column;gap:8px;max-height:560px;overflow:auto;padding-right:2px}
  .thumbs img{width:88px;height:88px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer;display:block;background:#f7f4ee}
  .thumbs img[aria-current="true"]{border-color:#111}

  .stage{
    position:relative;border:1px solid #f2ecd7;border-radius:14px;background:#f7f4ee;
    min-height:300px;padding:10px;overflow:hidden;text-align:center;
  }
  .stage img{
    max-width:100%;max-height:560px;width:auto;height:auto;object-fit:contain;display:inline-block;
  }
  .nav{position:absolute;top:50%;transform:translateY(-50%);background:#fff;border:0;border-radius:50%;width:40px;height:40px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.12)}
  .nav.prev{left:10px}.nav.next{right:10px}

  /* 表單 */
  label{display:block;margin:12px 0 8px;font-weight:800}
  select,button,input{font:inherit}
  select{width:100%;padding:10px 12px;border:1px solid #e9e1c7;border-radius:10px;background:#fff}

  .swatches{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .swatch{width:34px;height:34px;border-radius:10px;border:2px solid transparent;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
  .swatch[aria-pressed="true"]{outline:2px solid #111;outline-offset:2px}

  /* 單色（含 Light Blue / Dark Blue） */
  .swatch.white{background:#fff;border-color:#e5e1d0}
  .swatch.black{background:#111}
  .swatch.orange{background:#fb923c}
  .swatch.gold{background:linear-gradient(135deg,#f59e0b,#facc15)}
  .swatch.red{background:#ef4444}
  .swatch.green{background:#10b981}
  .swatch.blue{background:#3b82f6}
  .swatch.lightblue{background:#93c5fd}
  .swatch.darkblue{background:#1e3a8a}
  .swatch.purple{background:#8b5cf6}
  .swatch.brown{background:#8b5e3c}
  .swatch.yellow{background:#fde047}

  /* 半分色（50/50 split） */
  .swatch.split{background:linear-gradient(90deg,var(--c1,#000) 50%,var(--c2,#fff) 50%)}

  /* Random 彩條 */
  .swatch.random{background:repeating-linear-gradient(45deg,#f472b6 0 10px,#60a5fa 10px 20px,#10b981 20px 30px,#facc15 30px 40px)}

  /* 「＋」按鈕（More colours / Other）— 深咖啡底，白字，顯眼 */
  .swatch.more{
    background:#4b3a2b;border:2px solid #2a2100;color:#fff;
    font-weight:900;font-size:1rem;
  }

  /* 環形漸層（兩端色清楚） */
  .swatch.ring{
    position:relative;width:34px;height:34px;border-radius:10px;
    background:conic-gradient(var(--g1,#60a5fa), var(--g2,#1e3a8a));
    border:none;
    -webkit-mask:radial-gradient(farthest-side,transparent calc(100% - 6px),#000 0);
            mask:radial-gradient(farthest-side,transparent calc(100% - 6px),#000 0);
  }
  .swatch.ring[aria-pressed="true"]{outline:2px solid #1f1b14;outline-offset:2px}

  .btn{display:inline-block;margin-top:16px;background:#fff;border:2px solid var(--pill);color:var(--pill);padding:12px 18px;border-radius:999px;font-weight:900}
  .btn.primary{background:var(--pill);color:var(--pill-ink)}
  .note{margin-top:16px;font-size:.9rem;color:var(--muted)}
  .oops{padding:18px;border:1px solid #ffd1cd;background:#fff3f2;border-radius:12px}
</style>
</head>
<body>
<header>
  <a href="javascript:history.back()">← Back</a>
  <a href="index.html">Home</a>
</header>

<div class="wrap">
  <div id="grid" class="grid" style="display:none">
    <section>
      <div class="gallery">
        <div class="thumbs" id="thumbs"></div>
        <div class="stage">
          <img id="hero" alt="Product image" />
          <button class="nav prev" id="prev" aria-label="Previous image">‹</button>
          <button class="nav next" id="next" aria-label="Next image">›</button>
        </div>
      </div>
    </section>

    <aside>
      <h1 id="title">Loading…</h1>
      <div id="price" class="price"></div>

      <form id="buy">
        <label>Flavour
          <select id="flavour"></select>
        </label>

        <label>Pack Size
          <select id="pack"></select>
        </label>

        <label>Colour</label>
        <div class="swatches" id="swatches" role="group" aria-label="Choose colour theme"></div>
        <input type="text" id="customColour" placeholder="Enter custom colours…" style="display:none;margin-top:8px;width:100%;padding:10px;border:1px solid #e5e1d0;border-radius:10px" />

        <button type="submit" class="btn primary">Add to Cart</button>
        <button type="button" class="btn" onclick="location.href='mailto:sunnysugarart@gmail.com'">Email Us</button>
        <p class="note">Made to order. Contains egg & gluten. Nut-free kitchen but traces may exist. Please book ahead for peak seasons.</p>
      </form>
    </aside>
  </div>

  <div id="oops" class="oops" style="display:none"></div>
</div>

<script>
/* ========== 商品資料（Halloween + Christmas） ========== */
const CATALOG = {
  halloween:{ items:{
    "pumpkin-charm":{ title:"Pumpkin Charm", price:"A$ 8 per cookie",
      images:["images/halloween-pumpkin-charm.jpg","images/halloween-pumpkin-charm-2.jpg","images/halloween-pumpkin-charm-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "pumpkin-men":{ title:"Pumpkin Men", price:"A$ 10 per cookie",
      images:["images/halloween-pumpkin-men.jpg","images/halloween-pumpkin-men-2.jpg","images/halloween-pumpkin-men-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$10","5 PACK – A$50","10 PACK – A$100","15 PACK – A$150","20 PACK – A$200","30 PACK – A$300"],
      colours:["Light Blue","Dark Blue","Green","Purple","Random","More colours – leave a note"]
    },
    "cauldron-cake":{ title:"Cauldron Cake", price:"A$ 10 per cookie",
      images:["images/halloween-cauldron-cake.jpg","images/halloween-cauldron-cake-2.jpg","images/halloween-cauldron-cake-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$10","5 PACK – A$50","10 PACK – A$100","15 PACK – A$150","20 PACK – A$200","30 PACK – A$300"],
      colours:["Blue & Purple","Black","Random","More colours – leave a note"]
    },
    "drink-me":{ title:"Drink Me Bottles", price:"A$ 8 per cookie",
      images:["images/halloween-drink-me.jpg","images/halloween-drink-me-2.jpg","images/halloween-drink-me-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Orange","Black","Random","More colours – leave a note"]
    },
    "ghostie-boo":{ title:"Ghostie Boo", price:"A$ 6 per cookie",
      images:["images/halloween-ghostie-boo.jpg","images/halloween-ghostie-boo-2.jpg","images/halloween-ghostie-boo-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$6","5 PACK – A$30","10 PACK – A$60","15 PACK – A$90","20 PACK – A$120","30 PACK – A$180"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-skirt":{ title:"Witchy Skirt", price:"A$ 10 per cookie",
      images:["images/halloween-witchy-skirt.jpg","images/halloween-witchy-skirt-2.jpg","images/halloween-witchy-skirt-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$10","5 PACK – A$50","10 PACK – A$100","15 PACK – A$150","20 PACK – A$200","30 PACK – A$300"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "witchy-brew":{ title:"Witchy Brew",  price:"A$ 6 per cookie",
      images:["images/halloween-witchy-brew.jpg","images/halloween-witchy-brew-2.jpg","images/halloween-witchy-brew-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$6","5 PACK – A$30","10 PACK – A$60","15 PACK – A$90","20 PACK – A$120","30 PACK – A$180"],
      colours:["Green","Purple","Black","Orange","Random","More colours – leave a note"]
    },
    "witchy-hat":{ title:"Witchy Hat", price:"A$ 8 per cookie",
      images:["images/halloween-witchy-hat.jpg","images/halloween-witchy-hat-2.jpg","images/halloween-witchy-hat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Purple","Black","Random","More colours – leave a note"]
    },
    "spooky-cat":{ title:"Spooky Cat", price:"A$ 6 per cookie",
      images:["images/halloween-spooky-cat.jpg","images/halloween-spooky-cat-2.jpg","images/halloween-spooky-cat-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$6","5 PACK – A$30","10 PACK – A$60","15 PACK – A$90","20 PACK – A$120","30 PACK – A$180"],
      colours:["White","Orange","Purple","Black","Random","More colours – leave a note"]
    },
    "boo-candy":{ title:"Boo Candy", price:"A$ 8 per cookie",
      images:["images/halloween-boo-candy.jpg","images/halloween-boo-candy-2.jpg","images/halloween-boo-candy-3.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Orange","Purple","Black","Random","More colours – leave a note"]
    }
  }},
  christmas:{ items:{
    "snowflake":{ title:"Snowflake", price:"A$ 10 per cookie",
      images:["images/christmas-snowflake.jpg","images/christmas-snowflake-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$10","5 PACK – A$50","10 PACK – A$100","15 PACK – A$150","20 PACK – A$200","30 PACK – A$300"],
      colours:["Blue","Purple","Blue & Purple","Random","More colours – leave a note"]
    },
    "happy-tree":{ title:"Happy Tree", price:"A$ 8 per cookie",
      images:["images/christmas-happy-tree.jpg","images/christmas-happy-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["White","Red","Blue","Green","Yellow-green gradient","Blue gradient","Green gradient","Blue & Purple","Random","More colours – leave a note"]
    },
    "gingerbread":{ title:"Gingerbread Man", price:"A$ 10 per cookie",
      images:["images/christmas-gingerbread.jpg","images/christmas-gingerbread-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$10","5 PACK – A$50","10 PACK – A$100","15 PACK – A$150","20 PACK – A$200","30 PACK – A$300"],
      colours:["Brown"]
    },
    "candy-cane":{ title:"Candy Cane", price:"A$ 8 per cookie",
      images:["images/christmas-candy-cane.jpg","images/christmas-candy-cane-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["White","Red","Green","White & Red","White & Green","Red & Green","Random","More colours – leave a note"]
    },
    "surprise-tree":{ title:"Surprise Tree", price:"A$ 8 per cookie",
      images:["images/christmas-surprise-tree.jpg","images/christmas-surprise-tree-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Random","More colours – leave a note"]
    },
    "reindeer":{ title:"Reindeer", price:"A$ 8 per cookie",
      images:["images/christmas-reindeer.jpg","images/christmas-reindeer-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["White","Brown","Random","More colours – leave a note"]
    },
    "snowman":{ title:"Snowman", price:"A$ 8 per cookie",
      images:["images/christmas-snowman.jpg","images/christmas-snowman-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["White"]
    },
    "santa-belt":{ title:"Santa Belt", price:"A$ 8 per cookie",
      images:["images/christmas-santa-belt.jpg","images/christmas-santa-belt-2.jpg"],
      flavours:["Mixture of Vanilla & Chocolate","Signature Chocolate","Vanilla Shortbread"],
      packs:["1 PACK – A$8","5 PACK – A$40","10 PACK – A$80","15 PACK – A$120","20 PACK – A$160","30 PACK – A$240"],
      colours:["Red","More colours – leave a note"]
    }
  }}
};

/* ========== 顏色工具：把文字轉成 class / style（不顯示英文標籤） ========== */
function basicClass(n){
  n = (n||"").toLowerCase();
  if(n.includes("light blue")) return "lightblue";
  if(n.includes("dark blue"))  return "darkblue";
  if(n.includes("pink")) return "pink";
  if(n.includes("orange")) return "orange";
  if(n.includes("black")) return "black";
  if(n.includes("white")) return "white";
  if(n.includes("gold")) return "gold";
  if(n.includes("red")) return "red";
  if(n.includes("green")) return "green";
  if(n.includes("blue")) return "blue";
  if(n.includes("purple")) return "purple";
  if(n.includes("brown")) return "brown";
  if(n.includes("yellow")) return "yellow";
  if(n.includes("classic")) return "gold";
  if(n.includes("pastel"))  return "purple";
  return "white";
}
function basicColor(n){
  n = (n||"").toLowerCase();
  if(n.includes("light blue")) return "#93c5fd";
  if(n.includes("dark blue"))  return "#1e3a8a";
  if(n.includes("blue"))   return "#3b82f6";
  if(n.includes("purple")) return "#8b5cf6";
  if(n.includes("green"))  return "#10b981";
  if(n.includes("red"))    return "#ef4444";
  if(n.includes("white"))  return "#ffffff";
  if(n.includes("orange")) return "#fb923c";
  if(n.includes("yellow")) return "#fde047";
  if(n.includes("brown"))  return "#8b5e3c";
  return "#ccc";
}
function gradientPair(n){
  n = (n||"").toLowerCase();
  switch(n){
    case "blue gradient":          return {g1:"#bae6fd", g2:"#1e40af"};
    case "green gradient":         return {g1:"#86efac", g2:"#065f46"};
    case "yellow-green gradient":  return {g1:"#fde047", g2:"#10b981"};
    default: return {g1:"#bbb", g2:"#444"};
  }
}
function colourChip(label){
  const t=(label||"").toLowerCase().trim();
  if(t.startsWith("random")) return {cls:"swatch random", style:"", title:"", kind:"random"};
  if(t.includes("more")) return {cls:"swatch more", style:"", title:"+", kind:"more"};
  if(t.includes("&")){
    const [a,b]=t.split("&").map(s=>s.trim());
    return {cls:"swatch split", style:`--c1:${basicColor(a)};--c2:${basicColor(b)};`, title:"", kind:"split"};
  }
  if(t.endsWith("gradient")){
    const {g1,g2}=gradientPair(t);
    return {cls:"swatch ring", style:`--g1:${g1};--g2:${g2};`, title:"", kind:"gradient"};
  }
  return {cls:`swatch ${basicClass(t)}`, style:"", title:"", kind:"solid"};
}

/* ========== 渲染 ========== */
function getHash(name){const m=location.hash.match(new RegExp(name+"=([^&]+)"));return m?decodeURIComponent(m[1]):"";}

function render(){
  const cat=getHash("cat"), key=getHash("item");
  const item=CATALOG?.[cat]?.items?.[key];
  const grid=document.getElementById("grid"), oops=document.getElementById("oops");
  if(!item){ grid.style.display="none"; oops.style.display="block"; oops.textContent="Product not found. Please go back and choose again."; return; }
  oops.style.display="none"; grid.style.display="grid";

  // 文案
  document.getElementById("title").textContent=item.title || "Untitled";
  document.getElementById("price").textContent=item.price || "";

  // 下拉
  document.getElementById("flavour").innerHTML=(item.flavours||[]).map(f=>`<option>${f}</option>`).join("");
  document.getElementById("pack").innerHTML=(item.packs||[]).map(p=>`<option>${p}</option>`).join("");

  // 色票
  const sw=document.getElementById("swatches");
  const custom=document.getElementById("customColour");
  const colours=item.colours?.length ? item.colours : ["Random"];
  sw.innerHTML=colours.map((c,i)=>{
    const chip=colourChip(c);
    const more = chip.kind==="more" ? ' data-more="1"' : '';
    return `<button type="button" class="${chip.cls}" style="${chip.style}" data-color="${c}"${more} aria-pressed="${i===0}" aria-label="${c}">${chip.title||""}</button>`;
  }).join("");
  let chosen = colours[0];
  custom.style.display = chosen.toLowerCase().includes("more") ? "block" : "none";

  sw.querySelectorAll("button").forEach(btn=>{
    btn.onclick=()=>{
      sw.querySelectorAll("button").forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      chosen = btn.dataset.color;
      if(btn.dataset.more==="1"){ custom.style.display="block"; custom.focus(); }
      else { custom.style.display="none"; custom.value=""; }
    };
  });

  // 圖片（不裁切，維持原比例）
  const imgs = (item.images||[]).slice();
  const hero=document.getElementById("hero"), thumbs=document.getElementById("thumbs");
  let idx=0;
  function show(){ hero.src=imgs[idx]; [...thumbs.querySelectorAll("img")].forEach((t,i)=>t.setAttribute("aria-current", i===idx)); }
  thumbs.innerHTML = imgs.map((src,i)=>`<img src="${src}" alt="thumb ${i+1}" ${i===0?'aria-current="true"':''}>`).join("");
  thumbs.querySelectorAll("img").forEach((t,i)=>t.onclick=()=>{idx=i;show();});
  document.getElementById("prev").onclick=()=>{idx=(idx-1+imgs.length)%imgs.length;show();};
  document.getElementById("next").onclick=()=>{idx=(idx+1)%imgs.length;show();};
  show();

 <script>
// 解析 pack 選項字串，例如： "10 PACK – A$100"
function parsePack(val){
  const m = String(val).match(/(\d+)\s*PACK.*?A\$\s*([\d.]+)/i);
  if(m){ 
    const qty = Number(m[1]);
    const packTotal = Number(m[2]);
    const unit = packTotal / qty;
    return { qty, packTotal, unit };
  }
  // 如果沒有價錢（例如單顆價），就用 1 件、從 item.price 抓單價
  const unitFromTitle = (String((item.price||'').match(/([\d.]+)/))||'0').split(',')[0];
  return { qty: 1, packTotal: Number(unitFromTitle||0), unit: Number(unitFromTitle||0) };
}

document.getElementById("buy").onsubmit = (e)=>{
  e.preventDefault();

  const flavour = document.getElementById("flavour").value;
  const packVal = document.getElementById("pack").value;
  const colourNote = (custom.style.display==="block") ? (custom.value || "(no note)") : chosen;

  const parsed = parsePack(packVal);
  // 寫入購物車
  SSACart.add({
    id: key,                                // 來自 URL 的 item key（上方 render() 已有）
    title: item.title,
    image: (item.images&&item.images[0]) || "",
    flavour: flavour,
    pack: packVal,
    colour: colourNote,
    qty: parsed.qty,                         // 幾片餅乾
    price: Number(parsed.unit.toFixed(2))    // 每片單價，cart.html 會自行算 subtotal/total
  });

  // 更新徽章並導去購物車頁
  SSACart.updateBadge();
  location.href = 'cart.html';
};
</script>

render();
window.addEventListener("hashchange", render);
</script>
</body>
</html>
